<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPT-III Simulation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
        }
        .target {
            font-size: 40px;
            margin: 50px;
            display: none;
        }
        button {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>CPT-III Simulation</h1>
    <p>Press the "SPACE" key when you see the letter "X" on the screen.</p>

    <div id="target" class="target">A</div>

    <button id="startButton">Start Test</button>
    <div id="result"></div>

    <script>
        let letters = ["A", "B", "X", "C", "D"];
        let correctResponses = 0;
        let totalResponses = 0;
        let omissions = 0;
        let commissions = 0;
        let perseverations = 0;
        let reactionTimes = [];
        let testDuration = 20000; // 20 seconds
        let interval;
        let isTestRunning = false;
        let stimulusStartTime;

        const target = document.getElementById("target");
        const startButton = document.getElementById("startButton");
        const result = document.getElementById("result");

        function startTest() {
            correctResponses = 0;
            totalResponses = 0;
            omissions = 0;
            commissions = 0;
            perseverations = 0;
            reactionTimes = [];
            result.textContent = "";
            isTestRunning = true;
            startButton.disabled = true;

            interval = setInterval(() => {
                const randomLetter = letters[Math.floor(Math.random() * letters.length)];
                target.textContent = randomLetter;
                target.style.display = "block";
                stimulusStartTime = performance.now();

                setTimeout(() => {
                    if (target.textContent === "X" && target.style.display === "block") {
                        omissions++;
                    }
                    target.style.display = "none";
                }, 800); // Show letter for 800ms
            }, 1000); // Change letter every second

            setTimeout(endTest, testDuration);
        }

        function endTest() {
            clearInterval(interval);
            isTestRunning = false;
            startButton.disabled = false;
            target.style.display = "none";

            const hrt = reactionTimes.length > 0 ? (reactionTimes.reduce((a, b) => a + b, 0) / reactionTimes.length).toFixed(2) : "N/A";
            const hrtSd = reactionTimes.length > 1 ? Math.sqrt(reactionTimes.map(rt => Math.pow(rt - hrt, 2)).reduce((a, b) => a + b, 0) / (reactionTimes.length - 1)).toFixed(2) : "N/A";
            const variability = hrtSd;
            const dPrime = (correctResponses - commissions).toFixed(2);

            result.innerHTML = `
                <h2>Test Results</h2>
                <p>Total Responses: ${totalResponses}</p>
                <p>Correct Responses: ${correctResponses}</p>
                <p>Omissions: ${omissions}</p>
                <p>Commissions: ${commissions}</p>
                <p>Perseverations: ${perseverations}</p>
                <p>Hit Reaction Time (HRT): ${hrt} ms</p>
                <p>HRT Standard Deviation (SD): ${hrtSd}</p>
                <p>Variability: ${variability}</p>
                <p>Detectability (d'): ${dPrime}</p>
            `;
        }

        document.addEventListener("keydown", (event) => {
            if (!isTestRunning) return;

            if (event.code === "Space") {
                totalResponses++;
                if (target.textContent === "X" && target.style.display === "block") {
                    correctResponses++;
                    const reactionTime = performance.now() - stimulusStartTime;
                    reactionTimes.push(reactionTime);
                } else if (target.style.display === "block") {
                    commissions++;
                } else {
                    perseverations++;
                }
            }
        });

        startButton.addEventListener("click", startTest);
    </script>
</body>
</html>
