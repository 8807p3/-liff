<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿®å¾©æ€§å°è©±ç·´ç¿’å™¨ (Restorative Dialogue Trainer)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f3f4f6;
        }
        .card-flip {
            perspective: 1000px;
        }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card-flip.flipped .card-inner {
            transform: rotateY(180deg);
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .card-back {
            transform: rotateY(180deg);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .chat-bubble {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            margin-bottom: 10px;
            position: relative;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .chat-teacher {
            background-color: #e0f2fe;
            color: #0369a1;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        .chat-student {
            background-color: #f0fdf4;
            color: #15803d;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
    </style>
</head>
<body class="text-gray-800 min-h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-white shadow-sm py-6 px-4 text-center">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">æ‡²ç½°æ€§ vs ä¿®å¾©æ€§å°è©±</h1>
        <p class="text-gray-600 max-w-2xl mx-auto">
            ä¿®å¾©æ€§å°è©±èšç„¦æ–¼è®“å­¸ç”Ÿç†è§£è¡Œç‚ºå¾Œæœä¸¦æ‰¿æ“”è²¬ä»»ï¼Œè€ŒéæŒ‡è²¬æˆ–æ‡²ç½°ã€‚<br>
            <span class="text-sm text-blue-500 mt-1 inline-block font-medium">é»æ“Šä¸‹æ–¹ç´…è‰²å¡ç‰‡ï¼Œå­¸ç¿’å¦‚ä½•è½‰åŒ–å°è©±ï¼</span>
        </p>
    </header>

    <main class="flex-grow container mx-auto px-4 py-8 max-w-5xl">
        
        <!-- Part 1: Interactive Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-12">
            
            <!-- Card 1 -->
            <div class="flex flex-col gap-4">
                <div class="card-flip h-48 cursor-pointer group" onclick="flipCard(this, 'goal1')">
                    <div class="card-inner">
                        <!-- Front: Punitive -->
                        <div class="card-front bg-white border-2 border-red-200 hover:border-red-400">
                            <div class="text-4xl mb-3">ğŸš«</div>
                            <h3 class="text-red-500 font-bold text-lg mb-2">æ‡²ç½°æ€§æå•</h3>
                            <p class="text-gray-700 text-xl font-medium">ä½ åšäº†ä»€éº¼ï¼Ÿ ğŸ˜ </p>
                            <div class="mt-4 text-xs text-gray-400">é»æ“Šç¿»è½‰</div>
                        </div>
                        <!-- Back: Restorative -->
                        <div class="card-back bg-green-50 border-2 border-green-400">
                            <div class="text-4xl mb-3">âœ…</div>
                            <h3 class="text-green-600 font-bold text-lg mb-2">ä¿®å¾©æ€§æå•</h3>
                            <p class="text-gray-800 text-xl font-medium">ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Ÿ ğŸ¤”</p>
                        </div>
                    </div>
                </div>
                <!-- Goal Box (Hidden initially) -->
                <div id="goal1" class="hidden bg-blue-50 border-l-4 border-blue-400 p-4 rounded shadow-sm fade-in">
                    <div class="flex items-start">
                        <div class="text-2xl mr-3">ğŸ¯</div>
                        <div>
                            <h4 class="font-bold text-blue-700 text-sm uppercase">ç›®çš„ (Goal)</h4>
                            <p class="text-gray-700">é¼“å‹µå­¸ç”Ÿæè¿°æƒ…å¢ƒï¼Œé™ä½é˜²è¡›å¿ƒã€‚ ğŸ’›</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 2 -->
            <div class="flex flex-col gap-4">
                <div class="card-flip h-48 cursor-pointer group" onclick="flipCard(this, 'goal2')">
                    <div class="card-inner">
                        <!-- Front: Punitive -->
                        <div class="card-front bg-white border-2 border-red-200 hover:border-red-400">
                            <div class="text-4xl mb-3">ğŸ›‘</div>
                            <h3 class="text-red-500 font-bold text-lg mb-2">æ‡²ç½°æ€§æå•</h3>
                            <p class="text-gray-700 text-xl font-medium">ç‚ºä»€éº¼ä½ è¦é€™æ¨£åšï¼Ÿ ğŸ˜¡</p>
                            <div class="mt-4 text-xs text-gray-400">é»æ“Šç¿»è½‰</div>
                        </div>
                        <!-- Back: Restorative -->
                        <div class="card-back bg-green-50 border-2 border-green-400">
                            <div class="text-4xl mb-3">ğŸ¤</div>
                            <h3 class="text-green-600 font-bold text-lg mb-2">ä¿®å¾©æ€§æå•</h3>
                            <p class="text-gray-800 text-xl font-medium">èª°å—åˆ°äº†å½±éŸ¿ï¼Ÿ ğŸ’–</p>
                        </div>
                    </div>
                </div>
                <!-- Goal Box -->
                <div id="goal2" class="hidden bg-blue-50 border-l-4 border-blue-400 p-4 rounded shadow-sm fade-in">
                    <div class="flex items-start">
                        <div class="text-2xl mr-3">ğŸŒ</div>
                        <div>
                            <h4 class="font-bold text-blue-700 text-sm uppercase">ç›®çš„ (Goal)</h4>
                            <p class="text-gray-700">å°‡ç„¦é»è½‰å‘è¡Œç‚ºå¾Œæœï¼Œæå‡ç¤¾äº¤è¦ºå¯Ÿã€‚ ğŸŸ¢</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 3 -->
            <div class="flex flex-col gap-4">
                <div class="card-flip h-48 cursor-pointer group" onclick="flipCard(this, 'goal3')">
                    <div class="card-inner">
                        <!-- Front: Punitive -->
                        <div class="card-front bg-white border-2 border-red-200 hover:border-red-400">
                            <div class="text-4xl mb-3">ğŸ’¸</div>
                            <h3 class="text-red-500 font-bold text-lg mb-2">æ‡²ç½°æ€§æå•</h3>
                            <p class="text-gray-700 text-xl font-medium">ä½ è¦ä»˜å‡ºä»€éº¼ä»£åƒ¹ï¼Ÿ ğŸ™…â€â™‚ï¸</p>
                            <div class="mt-4 text-xs text-gray-400">é»æ“Šç¿»è½‰</div>
                        </div>
                        <!-- Back: Restorative -->
                        <div class="card-back bg-green-50 border-2 border-green-400">
                            <div class="text-4xl mb-3">ğŸ› ï¸</div>
                            <h3 class="text-green-600 font-bold text-lg mb-2">ä¿®å¾©æ€§æå•</h3>
                            <p class="text-gray-800 text-xl font-medium">å¦‚ä½•ä¿®å¾©é—œä¿‚ï¼Ÿ ğŸ› ï¸</p>
                        </div>
                    </div>
                </div>
                <!-- Goal Box -->
                <div id="goal3" class="hidden bg-blue-50 border-l-4 border-blue-400 p-4 rounded shadow-sm fade-in">
                    <div class="flex items-start">
                        <div class="text-2xl mr-3">ğŸŒ±</div>
                        <div>
                            <h4 class="font-bold text-blue-700 text-sm uppercase">ç›®çš„ (Goal)</h4>
                            <p class="text-gray-700">è®“å­¸ç”Ÿåƒèˆ‡åˆ¶å®šä¿®å¾©è¨ˆç•«ï¼Œå¼·åŒ–äººéš›é—œä¿‚æŠ€å·§ã€‚ â¤ï¸</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Part 2: Roleplay Simulation -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
            <div class="bg-indigo-600 text-white p-4 flex justify-between items-center">
                <h2 class="text-xl font-bold flex items-center">
                    <span class="text-2xl mr-2">ğŸ’¬</span> å¯¦æˆ°æ¼”ç·´ï¼šèª²å ‚è¡çª
                </h2>
                <button onclick="resetSimulation()" class="text-xs bg-indigo-800 hover:bg-indigo-700 px-3 py-1 rounded transition">é‡æ–°é–‹å§‹</button>
            </div>
            
            <div class="p-6 bg-gray-50 min-h-[300px] flex flex-col">
                <!-- Chat Area -->
                <div id="chat-container" class="flex-grow flex flex-col space-y-4 mb-6 overflow-y-auto h-64 p-2">
                    <div class="text-center text-gray-400 text-sm my-2">æƒ…å¢ƒï¼šå­¸ç”Ÿåœ¨èª²å ‚ä¸Šçªç„¶æ‰“æ–·ä½ èªªè©±...</div>
                    <!-- Initial Message will be injected by JS -->
                </div>

                <!-- Controls -->
                <div id="choices-container" class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <!-- Choices will be injected by JS -->
                    <button onclick="startSimulation()" class="col-span-1 md:col-span-2 bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition shadow">
                        é–‹å§‹æ¼”ç·´
                    </button>
                </div>
                
                <div id="feedback-area" class="hidden mt-4 p-3 rounded text-center text-sm font-medium"></div>
            </div>
        </div>

    </main>

    <footer class="bg-gray-800 text-gray-400 py-6 text-center text-sm">
        <p>Based on "æ‡²ç½°æ€§ vs ä¿®å¾©æ€§å°è©±" Educational Chart</p>
        <p>Interactive Learning Tool</p>
    </footer>

    <script>
        // --- Card Flip Logic ---
        function flipCard(element, goalId) {
            element.classList.toggle('flipped');
            const goalEl = document.getElementById(goalId);
            
            // Show goal if flipped to green side
            if (element.classList.contains('flipped')) {
                setTimeout(() => {
                    goalEl.classList.remove('hidden');
                }, 200);
            } else {
                goalEl.classList.add('hidden');
            }
        }

        // --- Simulation Logic ---
        const chatContainer = document.getElementById('chat-container');
        const choicesContainer = document.getElementById('choices-container');
        const feedbackArea = document.getElementById('feedback-area');

        let currentStep = 0;

        const scenario = [
            {
                // Step 0: Initial State
                action: "start"
            },
            {
                // Step 1: Teacher's first response
                prompt: "å­¸ç”Ÿæ‰“æ–·äº†ä½ çš„è©±ã€‚ä½ è©²æ€éº¼èªªï¼Ÿ",
                choices: [
                    {
                        text: "ä½ åšäº†ä»€éº¼ï¼Ÿç‚ºä»€éº¼é€™éº¼æ²’ç¦®è²Œï¼Ÿ ğŸ˜ ",
                        type: "punitive",
                        feedback: "å­¸ç”Ÿæ„Ÿåˆ°è¢«æŒ‡è²¬ï¼Œè®Šå¾—é˜²è¡›ã€‚è©¦è©¦å¦ä¸€ç¨®æ–¹å¼ã€‚",
                        nextStep: 1 // Stay on this step
                    },
                    {
                        text: "ç™¼ç”Ÿäº†ä»€éº¼äº‹è®“ä½ é€™éº¼æ€¥è‘—æƒ³æ’è©±ï¼Ÿ ğŸ¤”",
                        type: "restorative",
                        feedback: "å¾ˆå¥½ï¼é€™èƒ½é¼“å‹µå­¸ç”Ÿæè¿°æƒ…å¢ƒï¼Œè€Œä¸æ˜¯æ„Ÿåˆ°è¢«æ”»æ“Šã€‚",
                        nextStep: 2
                    }
                ]
            },
            {
                // Step 2: Student responds
                action: "student_reply",
                text: "æˆ‘åªæ˜¯æƒ³å¿«é»èªªæˆ‘çš„æƒ³æ³•ï¼Œæ€•ç­‰ä¸€ä¸‹å°±å¿˜äº†ã€‚",
                nextStep: 3
            },
            {
                // Step 3: Teacher's second response
                prompt: "å­¸ç”Ÿè§£é‡‹äº†åŸå› ã€‚ä½ è©²å¦‚ä½•å¼•å°ï¼Ÿ",
                choices: [
                    {
                        text: "ä¸ç®¡æ€æ¨£ï¼Œæ‰“æ–·äººå°±æ˜¯ä¸å°ï¼Œä½ è¦ä»˜å‡ºä»€éº¼ä»£åƒ¹ï¼Ÿ ğŸ›‘",
                        type: "punitive",
                        feedback: "é€™æœƒç ´å£é—œä¿‚ï¼Œå­¸ç”Ÿå­¸ä¸åˆ°å¦‚ä½•å°Šé‡ä»–äººï¼Œåªå­¸æœƒææ‡¼ã€‚",
                        nextStep: 3 // Stay
                    },
                    {
                        text: "æˆ‘æ‡‚ä½ å¾ˆèˆˆå¥®æƒ³åˆ†äº«ï¼Œä½†ç•¶ä½ æ‰“æ–·æ™‚ï¼ŒåŒå­¸å¯èƒ½è¦ºå¾—æ²’è¢«è½åˆ°ã€‚ ğŸ¤",
                        type: "restorative",
                        feedback: "å¤ªæ£’äº†ï¼é€™å°‡ç„¦é»è½‰å‘è¡Œç‚ºå°ä»–äººçš„å½±éŸ¿ (ç¤¾äº¤è¦ºå¯Ÿ)ã€‚",
                        nextStep: 4
                    }
                ]
            },
            {
                // Step 4: Conclusion
                action: "conclusion",
                text: "æˆ‘å€‘å¯ä»¥æ€éº¼åšè®“å¤§å®¶æ„Ÿè¦ºæ›´å¥½ï¼Ÿ (ä¿®å¾©é—œä¿‚)",
                subtext: "å­¸ç”Ÿï¼šé‚£æˆ‘ä¸‹æ¬¡å…ˆå¯«ä¸‹ä¾†ï¼Œç­‰å¤§å®¶èªªå®Œå†èˆ‰æ‰‹ã€‚"
            }
        ];

        function addMessage(role, text) {
            const div = document.createElement('div');
            div.className = `chat-bubble ${role === 'teacher' ? 'chat-teacher' : 'chat-student'}`;
            
            const icon = role === 'teacher' ? 'ğŸ‘©â€ğŸ«' : 'ğŸ§‘â€ğŸ“';
            const label = role === 'teacher' ? 'è€å¸«' : 'å­¸ç”Ÿ';
            
            div.innerHTML = `<div class="text-xs font-bold opacity-75 mb-1">${icon} ${label}</div>${text}`;
            chatContainer.appendChild(div);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function showFeedback(msg, type) {
            feedbackArea.textContent = msg;
            feedbackArea.className = `mt-4 p-3 rounded text-center text-sm font-medium fade-in ${type === 'punitive' ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}`;
            feedbackArea.classList.remove('hidden');
        }

        function hideFeedback() {
            feedbackArea.classList.add('hidden');
        }

        function renderChoices(stepIndex) {
            choicesContainer.innerHTML = '';
            const stepData = scenario[stepIndex];
            
            stepData.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = `p-3 rounded-lg border-2 text-left transition hover:shadow-md ${choice.type === 'punitive' ? 'border-red-200 hover:bg-red-50 text-red-800' : 'border-green-200 hover:bg-green-50 text-green-800'}`;
                btn.innerHTML = choice.text;
                btn.onclick = () => handleChoice(choice);
                choicesContainer.appendChild(btn);
            });
        }

        function handleChoice(choice) {
            // Add teacher's message
            addMessage('teacher', choice.text);
            
            // Show feedback
            showFeedback(choice.feedback, choice.type);

            if (choice.type === 'restorative') {
                // Disable buttons temporarily
                const btns = choicesContainer.querySelectorAll('button');
                btns.forEach(b => b.disabled = true);
                
                setTimeout(() => {
                    hideFeedback();
                    currentStep = choice.nextStep;
                    processStep();
                }, 2000);
            }
        }

        function processStep() {
            const stepData = scenario[currentStep];

            if (stepData.action === 'student_reply') {
                setTimeout(() => {
                    addMessage('student', stepData.text);
                    setTimeout(() => {
                        currentStep = stepData.nextStep;
                        processStep();
                    }, 1000);
                }, 500);
            } else if (stepData.action === 'conclusion') {
                setTimeout(() => {
                    addMessage('teacher', stepData.text);
                    setTimeout(() => {
                        addMessage('student', stepData.subtext);
                        choicesContainer.innerHTML = `<div class="col-span-1 md:col-span-2 text-center p-4 bg-blue-100 text-blue-800 rounded-lg font-bold">ğŸ‰ æ¼”ç·´å®Œæˆï¼ä½ æˆåŠŸé‹ç”¨äº†ä¿®å¾©æ€§å°è©±ã€‚</div>`;
                    }, 1000);
                }, 500);
            } else if (stepData.choices) {
                renderChoices(currentStep);
            }
        }

        function startSimulation() {
            currentStep = 1;
            chatContainer.innerHTML = '<div class="text-center text-gray-400 text-sm my-2">æƒ…å¢ƒï¼šå­¸ç”Ÿåœ¨èª²å ‚ä¸Šçªç„¶æ‰“æ–·ä½ èªªè©±...</div>';
            hideFeedback();
            processStep();
        }

        function resetSimulation() {
            currentStep = 0;
            chatContainer.innerHTML = '<div class="text-center text-gray-400 text-sm my-2">æƒ…å¢ƒï¼šå­¸ç”Ÿåœ¨èª²å ‚ä¸Šçªç„¶æ‰“æ–·ä½ èªªè©±...</div>';
            choicesContainer.innerHTML = `
                <button onclick="startSimulation()" class="col-span-1 md:col-span-2 bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 transition shadow">
                    é–‹å§‹æ¼”ç·´
                </button>
            `;
            hideFeedback();
        }

    </script>
</body>
</html>
